<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style.css">
        <!--TODO: Need to access D3 in the console?-->
        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    </head>
    
    <body>
        <div class="bar"></div> 

        <h1>Learning D3</h1>
        <script type="module">
            import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
            console.log("Imported D3");
            
            var dataset = [
                20, 13, 22, 21, 44, 15, 39, 9, 25, 18
            ];
            //var dataset = []
            //for (var i=0; i<25; i++) {
            //    // Generate a random number between 0 and 100
            //    var d = Math.random() * 100;
            //    dataset.push(d);
            //}
            //d3.select("body").selectAll("p")
            //    .data(dataset)
            //    .enter()
            //    .append("div")
            //    .attr("class", "bar")
            //    .style("height", function(d) {
            //        var barHeight = d*5; // scale the height for visibility
            //        return barHeight + "px";
            //    })
            //    .style("background-color", function(d) {
            //        if (d > 50) {
            //            return "#cc5555"; // a nicer red
            //        } else {
            //            return "teal";
            //        }
            //    });
            
            // Create an SVG element inside the DOM body element
            var svgWidth = 800;
            var svgHeight = 500;
            var barPadding = 1;
            var svg = d3.select("body")
                .append("svg")
                .attr("width", svgWidth)
                .attr("height", svgHeight)
                .attr("style", "outline: thin solid #dedede");

            // Select all the *future* rectangles that will be created
            svg.selectAll("rect")
                .data(dataset)  // dataset is passed onto enter()
                .enter()        // which creates an empty reference to each data value
                .append("rect") // Creates a rectangle for each data value
                .attr("x", function(data, index) {
                    return index * (svgWidth / dataset.length);
                })   // Apply the following attributes to each rectangle
                .attr("y", function(data, index) {
                    return svgHeight - (data*4);
                })
                .attr("width", function(data, index) {
                    return (svgWidth / dataset.length) - barPadding;
                })
                .attr("height", function(data, index) {
                    return data*4;
                })
                .attr("fill", function(data, index) {
                    return "rgb(" + Math.round(data*10) + ", 0, 0)";
                });

            // Selects all *future* text that will be created
            svg.selectAll("text")
                .data(dataset) // the dataset to be passed into enter()
                .enter()
                .append("text") // Creates an empty reference to a text object for this data value
                .text(function(data, index) { // Not set via attr()
                    return data;
                })
                .attr("x", function(data, index) {
                    // Set the label to be positioned in the middle of the bar
                    let barWidth = (svgWidth / dataset.length) - barPadding;
                    return index * (svgWidth / dataset.length) + (barWidth / 2); // padding
                })
                .attr("y", function(data, index) {
                    return svgHeight - (data*4) + 20; // +20 padding
                })
                .attr("fill", "white")
                .attr("font-size", "12px")
                .attr("font-family", "sans-serif")
                .attr("text-anchor", "middle"); // set label to be in the middle

            //var dataset = [5, 10, 15, 20, 25];
            //// Create circle elements inside the SVG element
            //var circles = svg.selectAll("circle") // returns a reference to empty Circle elements
            //    .data(dataset) // Binds each data item in `dataset` to each Circle element
            //    .enter() // Return a reference to the new element
            //    .append("circle"); // Add circle to the DOM

            //// Apply styles to each Circle, depending on the binded data item
            //circles.attr("cx", function(d, i) { // d=data element, i=index
            //        return (i*50) + 25;
            //    })
            //    .attr("cy", height/2)
            //    .attr("r", function(d) {
            //        return d;
            //    })
            //    .attr("fill", function(d) {
            //        if (d%10 == 0) {
            //            return "#db7fef";
            //        } else {
            //            return "#91ebf7";
            //        }
            //    })
            //    .attr("stroke", "#d3f9ff")
            //    .attr("stroke-width", 5);
           
            // Scatterplot dataset
            var dataset = [
                [134, 223],
                [208, 117],
                [121, 55],
                [311, 211],
                [145, 131],
                [212, 17],
                [800, 400]
            ];
            // Create the SVG element in the DOM
            var svg = d3.select("body")
                .append("svg")
                .attr("width", svgWidth)
                .attr("height", svgHeight)
                .attr("style", "outline: thin solid #dedede");
            
            // Create scales that will ensure that the points always fit in the SVG object
            // We fit the dataset values to the width and height of the SVG
            var padding = 50;
            var xScale = d3.scaleLinear()
                // Across the dataset, compare each value's first element with each other
                .domain([0, d3.max(dataset, function(data) { return data[0]; })])
                // Map the dataset x-values to the bounds of the SVG's width
                .range([padding, svgWidth - padding]);
            var yScale = d3.scaleLinear()
                .domain([0, d3.max(dataset, function(data) { return data[1]})])
                .range([svgHeight - padding, padding]);

            var aScale = d3.scaleSqrt()
                .domain([0, d3.max(dataset, function(data) { return data[1]; })])
                .range([0, 10]); // Range is arbitrary - what matters is that the circle areas are relative
            
                // For each datapoint, we create a circle
            svg.selectAll("circle") // Get a reference to all *future* circles that will be created
                .data(dataset)      // Get the dataset to be applied to each circle
                .enter()            // Pass in `dataset` to enter()
                .append("circle")   // Create the actual circle
                .attr("cx", function(data, index) {
                    return xScale(data[0]);
                })
                .attr("cy", function(data, index) {
                    return yScale(data[1]);
                })
                .attr("fill", "black")
                .attr("r", function(data, index) {
                    return aScale(data[1]);
                });

            // Labels for each point in the scatterplot
            svg.selectAll("text")
                .data(dataset)
                .enter()
                .append("text")
                .text(function(data, index) {
                    return "(" + data[0] + ", " + data[1] + ")";
                })
                .attr("x", function(data, index) {
                    return xScale(data[0]);
                })
                .attr("y", function(data, index) {
                    return yScale(data[1]) + 20; // padding 
                })
                .attr("text-anchor", "middle");

            var timeParser = d3.timeParse("%m/%d/%y");
            var csvRowConverter = function(row) {
                return {
                    date: timeParser(row.Date),
                    amount: parseInt(row.Amount)
                };
            };
            d3.csv("data/time_scale_data.csv", csvRowConverter)
                .then(function(parsedData) {
                    console.log(parsedData);
                });
        </script>
    </body>
    
</html>
